name: longrun testing
on:
  push:
    branches: [ main ]
  workflow_dispatch:
    
permissions:
  contents: read

jobs:
  k6-test:
    name: Run scenarigo and k6 test
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@8ade135a41bc03ea155e62e844d188df1ea18608 # v4.1.0
      - name: Set up
        run: ./e2e/scenario_setup.sh
      - name: Install k6
        run: |
          curl https://github.com/grafana/k6/releases/download/v0.45.1/k6-v0.45.1-linux-amd64.tar.gz -L | tar xvz --strip-components 1  
      - name: Run load test
        run: |
          mkdir -p output
          ./k6 run e2e/k6-load/local_long_test.js
      - name: Archive load test results
        uses: actions/upload-artifact@a8a3f3ad30e3422c9c7b888a15615d19a852ae32 # v3.1.3
        with:
          name: load-test-report
          path: output/*